"use strict";(self.webpackChunkFusion=self.webpackChunkFusion||[]).push([[53890],{72131:(t,e,i)=>{i.d(e,{Z:()=>r});var n=i(60849),a=i(57440);const r=()=>{const t={...a.X.saved_customizations,defaultValue:!1};return{isSavedCustomizationsXpEnabled:(0,n.ip)(t)}}},3289:(t,e,i)=>{i.d(e,{GJ:()=>c,GZ:()=>f,RO:()=>s,RZ:()=>l,US:()=>d,Xr:()=>o,_k:()=>p,aV:()=>r,jD:()=>m,nB:()=>u});var n=i(81479),a=i(47986);const r=160,o=160,u=6,s=4,d=1280,m=76,l=60,c="0379a62a-1156-4ddb-a09a-7e1dc45d5dfb",p=(0,n.Z)({buyXGetYItemPromotion:null,volumeDiscountPromotion:null}),f=[a.FSm.primaryBundledStoreUuid,a.FSm.primaryDraftOrderUUID,a.FSm.liveOrderUuid]},53890:(t,e,i)=>{i.d(e,{TX:()=>Z,ZP:()=>g});var n=i(36151),a=i(13422),r=i(10208),o=i(76594),u=i(54669),s=i(67476),d=i(14016),m=i(83960),l=i(93008),c=i(81436),p=i(49373),f=i(15649),y=i(49201),I=i(77705);const S=(t,e)=>{const i=(0,d.T)(),n=(0,f.Z)(),{currentUserCartItems:a,draftOrderUuid:r,isDraftOrderParticipant:o}=(0,m.Z)(),{groupOrder:u,getGroupOrder:S,shouldGetGroupOrder:E}=(0,l.Z)(r),{hasGroupOrderForStore:D}=(0,s.Z)(t||""),Q=(0,I.Z)();(0,c.Z)((()=>E?S():null),[E,S],"use-draft-order-spending-limit-validation");const x=(0,p.DR)({cartItems:a,isQuantityStepperWithNestedModifiersEnabled:Q})+e,C=u.data?.spendingLimitAmount,M=C?.currencyCode;if(!C||!M)return null;const z=C.amount;return D&&o&&x>z?i("go.spending_limit_exceeded",{spendingLimit:(0,y.xG)(n,M,z)}):null};var E=i(70247),D=i(57597),Q=i(44606),x=i(66958),C=i(3289),M=i(80310),z=i(62155),L=i(72131),O=i(94813),P=i(60849),_=i(57440),b=i(22208),U=i(35212);const T=t=>{let{itemUuid:e,defaultQuantity:i,quantityIncrement:a,updateDecimalQuantity:r,isEditItem:o,didSetDefaultQuantity:u,setDidSetDefaultQuantity:s}=t;const d=(0,O.TH)(),m=(0,n.useRef)(!1),{previousContext:l}=d.state||{},c=l===b.x9.PDP_CROSS_SELL,p=(0,U.Z)(c),f=(0,P.ip)({..._.X.product_details_page_reset_quantity_cross_sell,defaultValue:!1}),y=(0,n.useCallback)((t=>{m.current=!0,r(Q.Tf.from(t).updateExponent(a.exponent).toBaseDecimal())}),[a.exponent,r]);(0,n.useEffect)((()=>()=>{f&&e&&u&&s(!1)}),[u,f,e,s]),(0,n.useEffect)((()=>{if(f&&!o&&!m.current&&e&&(c||p))return(0===a.exponent||i)&&y(i||1),()=>{m.current=!1}}),[i,c,o,p,f,e,a.exponent,y])},h=(t,e)=>{const i=t?.data;return i?(0,r.h7)(i.customizationsList,Object.keys(B(t,e))):""},B=(t,e)=>{const i=t?.data;if(!i)return{};const n=(0,r.qH)(e,t?.data?.customizationsList||[])||{};return(0,r.xe)(i.customizationsList,n)},v=t=>{let{menuItem:e,customizations:i,quantity:n,itemUpsellState:o,isQuantityStepperWithNestedModifiersEnabled:u}=t;const s=e?.data?.price||0,d=(0,r.qH)(i,e?.data?.customizationsList||[])||{};return(0,a.uT)({itemQuantity:n,itemPrice:s,customizations:d,upsellItems:o.itemsArray,upsellItemsMap:o.itemMap,isQuantityStepperWithNestedModifiersEnabled:u})};let Z=function(t){return t.increment="INCREMENT",t.decrement="DECREMENT",t.set="SET",t}({});const g=t=>{let{store:e,menuItem:i,selectedSavedCustomizationIndex:d,setSelectedSavedCustomizationIndex:m,initialQuantity:l,initialDecimalQuantity:c,initialCustomizations:p,initialSpecialInstructions:f,isEditQuantityFlow:y}=t;const O=i.data?(0,x.L5)(i.data):null,P=O?.defaultDecimal||O?.minPermitted,_=Q.Tf.from(O?.increment??1).toBaseDecimal(),b=Q.Tf.from(O?.minPermitted??1).updateExponent(_?.exponent||0).toBaseDecimal(),U=(0,D.Z)({item:i.data,storeUuid:e.data?.uuid,counterAdjustment:l}),g=(t=>{let{initialQuantity:e,initialDecimalQuantity:i,quantityIncrement:n,defaultQuantity:a}=t;return i?i.toBaseDecimal():e?Q.Tf.from(e).updateExponent(n.exponent).toBaseDecimal():a||Q.Tf.from(1).updateExponent(n.exponent).toBaseDecimal()})({initialQuantity:l,initialDecimalQuantity:c,defaultQuantity:P,quantityIncrement:_}),G=e?.data?.uuid||"",{isDraftOrderParticipantForStore:A,canEditGroupOrderCart:k}=(0,s.Z)(G),{serverCart:q}=(0,E.iQ)(),[F,R]=(0,n.useState)(g),[W,X]=(0,n.useState)(!1),[N,w]=(0,n.useState)(!1),{isItemInPromotion:V,initialItemQuantity:Y}=(t=>{const{itemPromotionV2:e}=t||{},i={isItemInPromotion:!1,initialItemQuantity:1};if(!t)return i;const{promotionData:n}=e||{};if(!n?.type)return i;switch(n.type){case C._k.buyXGetYItemPromotion:{const{buyQuantity:t,getQuantity:e}=n;return{isItemInPromotion:!0,initialItemQuantity:1===t&&1===e?2:1}}default:return i}})(i.data),{isSavedCustomizationsXpEnabled:j}=(0,L.Z)(),H=(0,n.useMemo)((()=>i?.data?.customizationsList||[]),[i?.data?.customizationsList]),$=Q.Tf.from(F||1).toFloat();(0,n.useEffect)((()=>{"number"!=typeof _?.exponent||F.exponent===_.exponent||F===P||c||R(Q.Tf.from($).updateExponent(_.exponent).toBaseDecimal())}),[F,P,$,F.exponent,_.exponent,c]),(0,n.useEffect)((()=>{y||"number"!=typeof P?.exponent||F.exponent===P.exponent||N||(w(!0),R(Q.Tf.from(P).toBaseDecimal()))}),[N,P,F.exponent,y]),(0,n.useEffect)((()=>{!V||W||l||(X(!0),R({base:Y,exponent:0}))}),[i,W,l,Y,V]);const[J,K]=(0,n.useState)(f||""),[tt,et]=(0,n.useState)(p||{});(0,n.useEffect)((()=>{const t=(0,z.mq)(i.data?.productDetailsItems);if(j&&-1===d)return et({}),void K("");const e=j&&null!=d&&d>=0?t?.preselectedCustomizationSelection?.[d]?.item:void 0,{customizations:n,specialInstructions:a}=(t=>{let{itemUuid:e,menuItemCustomizationList:i,initialCustomizations:n,orderItem:a}=t;if(!e||!i)return null;if(n)return{customizations:(0,r.iY)(n||{},i,!1)};if(a){const t=a?.customizationV2s||[],e=a?.specialInstructions,n=(0,r.up)((0,M.rB)(t));return{customizations:(0,r.iY)(n,i,!0),...e?{specialInstructions:e}:null}}return null})({itemUuid:i.data?.uuid,menuItemCustomizationList:H,initialCustomizations:p,orderItem:e})||{};n&&et(n),a&&K(a)}),[H,p,i.data?.uuid,i.data?.productDetailsItems,d,j]),(0,n.useEffect)((()=>{y&&(N||!l&&!c||(w(!0),R(g)))}),[g,N,c,l,y]),T({itemUuid:i.data?.uuid,defaultQuantity:P,quantityIncrement:_,updateDecimalQuantity:R,isEditItem:Boolean(y||l),didSetDefaultQuantity:N,setDidSetDefaultQuantity:w});const[it,nt]=(0,n.useReducer)(o.L,o.E);const at=(0,n.useCallback)((t=>K(t)),[]),rt=i?.data?.sectionUuid||"",ot=(e?.data?.sections||[]).find((t=>t.uuid===rt)),ut=null==ot||!1!==ot.isOnSale,st=Boolean(e?.data?.isOpen),dt=(0,u.Z)(),mt=Boolean(e?.data?.isWithinDeliveryRange),lt=(i?.data?.suspendUntil||0)>0,ct=Boolean(e?.data?.isPreview),pt="geolocation_api"!==dt?.originType,ft=(0,I.Z)(),yt=ct||ut&&!lt&&(A||st&&Boolean(dt)&&pt&&mt),It=v({menuItem:i,customizations:tt,quantity:$,itemUpsellState:it,isQuantityStepperWithNestedModifiersEnabled:ft}),St=Boolean(l),Et=St&&l?v({menuItem:i,customizations:tt,quantity:l,itemUpsellState:it,isQuantityStepperWithNestedModifiersEnabled:ft}):0,Dt=S(G,St?It-Et:It),Qt=(t=>"eats.exceed_spending_limit.error"===t?.error?.meta?.code&&t?.error?.message?t?.error?.message:null)(q),xt=Dt||Qt,Ct=((t,e,i,n)=>{const o=t?.data?.price||0,u=(0,r.qH)(e,t?.data?.customizationsList||[])||{},{itemPromotionV2:s}=t?.data||{},{promotionData:d}=s||{},m=i;let l=0;if(!d?.type)return null;switch(d.type){case C._k.buyXGetYItemPromotion:{const{buyQuantity:t,getQuantity:e,maxRedemptionCount:i}=d,r=t+e;if(t>0&&e>0&&m>=r){const t=Math.floor(m/r);l=m-e*Math.min(i,t)}return(0,a.W$)(l,o,u,n.itemsArray,n.itemMap)}case C._k.volumeDiscountPromotion:{const{buyQuantity:t,discountAmount:e,maxRedemptionCount:i}=d;if(t>0&&m>=t){const e=Math.floor(m/t);l=Math.min(i,e)}return(0,a.W$)(l,o,u,n.itemsArray,n.itemMap,e,m)}default:return null}})(i,tt,$,it)??0;return{quantity:$,updateQuantity:function(t,e){const i=t===Z.set&&null!=e?Q.Tf.from(e):Q.Tf.from(_).multiply(t===Z.increment?1:-1).add(F);Q.Tf.from(i).isGte(b)&&(t===Z.decrement||U({increment:Q.Tf.from(i).toFloat(),showSnackbarWarning:!0})!==D.y.ABOVE_LIMIT)&&R(i.toBaseDecimal())},decimalQuantity:F,specialInstructions:J,updateSpecialInstructions:at,updateCustomizations:t=>{j&&m&&m(null),et(t)},selectedCustomizations:tt,itemsUpsell:it,updateUpsellItemQuantity:(t,e)=>{nt(e>0?{type:"ADD_ITEM_UPSELL",payload:{item:t}}:{type:"SUB_ITEM_UPSELL",payload:{item:t}})},hasErrors:Object.keys(B(i,tt)).length>0,isOnSale:yt,totalPrice:It,spendingLimitError:xt,canEditGroupOrderCart:k,firstIncompleteGroup:h(i,tt),discountedPrice:Ct}}},67476:(t,e,i)=>{i.d(e,{Z:()=>r});var n=i(83960),a=i(69694);const r=t=>{const e=(0,a.Z)(t),{hasGroupOrder:i,isDraftOrderCartLocked:r,isDraftOrderCreator:o,isDraftOrderParticipant:u,draftOrder:s}=(0,n.Z)(t),d=i&&e.cart.data?.storeUuid===t,m=o||!(d&&r),l=u&&d;return{isBundled:Boolean(s?.bundleGroupInfo),hasGroupOrderForStore:d,canEditGroupOrderCart:m,isDraftOrderParticipantForStore:l}}},76594:(t,e,i)=>{i.d(e,{E:()=>n,L:()=>a});const n={itemMap:{},itemsArray:[]};function a(t,e){if("ADD_ITEM_UPSELL"===e.type){const i=e.payload.item,{itemMap:n,itemsArray:a}=t;return n[i.uuid]?{itemMap:{...n,[i.uuid]:n[i.uuid]+1},itemsArray:a}:{itemMap:{...n,[i.uuid]:1},itemsArray:[...a,i]}}if("SUB_ITEM_UPSELL"===e.type){const i=e.payload.item,{itemMap:n,itemsArray:a}=t;if(n[i.uuid]){if(n[i.uuid]>1)return{itemMap:{...n,[i.uuid]:n[i.uuid]-1},itemsArray:a};const t=a.findIndex((t=>t.uuid===i.uuid)),e={...n},r=[...a];return delete e[i.uuid],r.splice(t,1),{itemMap:e,itemsArray:r}}return{itemMap:n,itemsArray:a}}return t}}}]);